# if you are restarting the run, please uncomment this line
#RESTART
# include topology info
MOLINFO STRUCTURE=../../../1-refinement/3-Map-Scaling/step3_input_xtc.pdb WHOLE
# define map atoms 
system-map: GROUP NDX_FILE=../../../1-refinement/0-Building/index.ndx NDX_GROUP=System-MAP
# make map atoms whole
WHOLEMOLECULES ...
ADDREFERENCE EMST
ENTITY0=system-map STRIDE=4
... WHOLEMOLECULES

# create EMMI score
EMMIVOX ...
# name of this action
LABEL=emmi
# general parameters - do not change this!
# NL_STRIDE: update neighbor list stride
# NL_DIST_CUTOFF: distance cutoff in nm
# NL_GAUSS_CUTOFF: cutoff based on the Gaussian sigma
TEMP=300.0 NL_STRIDE=50 NL_DIST_CUTOFF=1.0 NL_GAUSS_CUTOFF=3.0
# define atoms for cryo-EM restraint and read experimental data
ATOMS=system-map DATA_FILE=../../../1-refinement/1-Map-Preparation/emd_plumed_aligned.dat
# info about the experimental map
NORM_DENSITY=NORM_DENSITY_ RESOLUTION=RESOLUTION_
# data likelihood (or noise model): Marginal
SIGMA_MIN=0.2 GPU
# output: in production write with the frequency at which XTC/TRR are written
STATUS_FILE=EMMIStatus WRITE_STRIDE=5000
# comment this if you have a hetero-complex
BFACT_NOCHAIN
# in ensemble modelling, you should *NOT* sample Bfactors, but read from input
# the minimum Bfactor found in single-structure refinement
# and keep constant and the same for all residues
BFACT_READ
# scale factor
SCALE=SCALE_
# correlation
CORRELATION
...

# in production, apply bias to system
# translate into bias - updated every 2/4 time steps
# emr: BIASVALUE ARG=emmi.scoreb STRIDE=2
emr: BIASVALUE ARG=emmi.scoreb STRIDE=4
#
# print output to file
PRINT ARG=emmi.* FILE=COLVAR STRIDE=5000
